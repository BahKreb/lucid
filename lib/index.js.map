{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["interface SodaElement {\r\n  tag: string | ((component: any) => SodaElement),\r\n  attrs: SodaAttributes;\r\n  children: string | any[];\r\n}\r\n\r\ninterface SodaComponent {\r\n  attrs: SodaAttributes,\r\n  update: () => void,\r\n  __dom: HTMLElement,\r\n  __element: SodaElement,\r\n  __children: number[],\r\n  __hooks: any[],\r\n  __hookId: number\r\n}\r\n\r\ntype SodaAttributes = { [key: string]: any };\r\n\r\nclass Soda {\r\n  private components: { [key: number]: SodaComponent } = {};\r\n  private currentComponent!: SodaComponent;\r\n  private id: number = 0;\r\n\r\n  private work: { cb: () => void, hookId: number }[] = [];\r\n\r\n  state(value: any, cb?: (prev: any, next: any) => boolean) {\r\n    const component = this.currentComponent;\r\n\r\n    component.__hooks[component.__hookId] = component.__hooks[component.__hookId] || value;\r\n    const id = component.__hookId;\r\n    const setState = (state: any, dontUpdate?: boolean) => {\r\n      const oldState = component.__hooks[id];\r\n      component.__hooks[id] = state;\r\n\r\n      if (!dontUpdate) {\r\n        if (cb) {\r\n          if (!cb(oldState, state)) component.update();\r\n        }\r\n        else {\r\n          component.update();\r\n        }\r\n      }\r\n\r\n      return state;\r\n    };\r\n    return [component.__hooks[component.__hookId++], setState];\r\n  }\r\n\r\n  effect(cb: () => (() => void) | void, deps: any[]) {\r\n    const component = this.currentComponent;\r\n\r\n    if (!component.__dom) {\r\n      this.work.push({\r\n        cb: () => { this.effect(cb, deps); },\r\n        hookId: component.__hookId++\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    const hookDeps = component.__hooks[component.__hookId];\r\n    const changed = hookDeps?.deps ? !deps.every((dep, i) => dep === hookDeps.deps[i]) : true;\r\n\r\n    if (!deps || changed) {\r\n      // If a cleanup function exists, call it\r\n      if (typeof component.__hooks[component.__hookId]?.cleanup === \"function\")\r\n        component.__hooks[component.__hookId].cleanup();\r\n\r\n      // Dependencies should be set before the callback is called\r\n      component.__hooks[component.__hookId] = {};\r\n      component.__hooks[component.__hookId].deps = deps;\r\n      component.__hooks[component.__hookId].cleanup = cb();\r\n    }\r\n\r\n    ++component.__hookId;\r\n  }\r\n\r\n  ref() {\r\n    return this.state({ dom: undefined })[0];\r\n  }\r\n\r\n  private createElement(\r\n    tag: string | ((component: any) => SodaElement),\r\n    attrs: { [key: string]: any },\r\n    ...children: any\r\n  ): SodaElement {\r\n    return { tag, attrs, children };\r\n  }\r\n\r\n  render(element: SodaElement, dom: HTMLElement) {\r\n    if (typeof element.tag === \"function\") {\r\n      const component: SodaComponent = {\r\n        attrs: element.attrs,\r\n        update: () => {\r\n          if (typeof element.tag === \"function\") {\r\n            //console.time(\"a\")\r\n\r\n            const previousComponent = this.currentComponent;\r\n            this.currentComponent = component;\r\n\r\n            component.__hookId = 0;\r\n            const newElement = element.tag(component);\r\n            this._update(component.__dom, newElement, component.__element, component)\r\n            component.__element = newElement;\r\n\r\n            this.currentComponent = previousComponent;\r\n\r\n            //console.timeEnd(\"a\")\r\n          }\r\n        },\r\n        __dom: undefined as unknown as HTMLElement,\r\n        __element: undefined as unknown as SodaElement,\r\n        __children: [],\r\n        __hooks: [],\r\n        __hookId: 0\r\n      };\r\n\r\n      const previousComponent = this.currentComponent;\r\n      this.currentComponent = component;\r\n\r\n      const id = this.id++;\r\n      this.components[id] = component;\r\n      this._render(dom, (component.__element = element.tag(component)), component, { svg: false, parent: true });\r\n\r\n      // Work should be processed before current component is set back to previous component\r\n      this.processWork();\r\n\r\n      this.currentComponent = previousComponent;\r\n\r\n      return id;\r\n    }\r\n  }\r\n\r\n  private _render(dom: HTMLElement, element: SodaElement | SodaElement[], component: SodaComponent, options: { svg: boolean, parent: boolean }) {\r\n    if (Array.isArray(element)) {\r\n      for (let i = 0; i < element.length; ++i) {\r\n        if (typeof element[i].tag === \"function\") { component.__children.push(this.render(element[i], dom) as number); }\r\n        else { this._render(dom, element[i], component, options); }\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    let elem: HTMLElement;\r\n    if (element.tag === \"svg\" || options.svg) {\r\n      elem = document.createElementNS(\"http://www.w3.org/2000/svg\", element.tag as string) as unknown as HTMLElement;\r\n      options.svg = true;\r\n    }\r\n    else {\r\n      elem = document.createElement(element.tag as string);\r\n    }\r\n\r\n    if (options.parent) { component.__dom = elem; options.parent = false; }\r\n\r\n    for (let key in element.attrs) {\r\n      if (key.startsWith(\"on\")) {\r\n        elem.addEventListener(key.substring(2).toLowerCase(), element.attrs[key], { capture: true })\r\n      }\r\n      else {\r\n        this.setDomAttribute(elem, key, element.attrs[key]);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < element.children.length; ++i) {\r\n      if (typeof element.children[i].tag === \"function\") {\r\n        component.__children.push(this.render(element.children[i], elem) as number);\r\n      }\r\n      else if (typeof element.children[i] === \"object\") {\r\n        this._render(elem, element.children[i], component, options);\r\n      }\r\n      else {\r\n        elem.appendChild(document.createTextNode(element.children[i]));\r\n      }\r\n    }\r\n\r\n    dom.appendChild(elem);\r\n  }\r\n\r\n  private _update(dom: HTMLElement, element: SodaElement, oldElement: SodaElement, component: SodaComponent) {\r\n    if (dom.tagName.toLowerCase() !== element.tag) {\r\n      const parent = dom.parentNode;\r\n      parent?.removeChild(dom);\r\n      dom = document.createElement(element.tag as string);\r\n      parent?.appendChild(dom);\r\n    }\r\n\r\n    for (let key in oldElement?.attrs) {\r\n      if (key.startsWith(\"on\")) {\r\n        if (oldElement.attrs && oldElement.attrs[key]) {\r\n          dom.removeEventListener(key.substring(2).toLowerCase(), oldElement.attrs[key], { capture: true });\r\n        }\r\n      }\r\n      else {\r\n        this.removeDomAttribute(dom, key);\r\n      }\r\n    }\r\n\r\n    for (let key in element?.attrs) {\r\n      if (key.startsWith(\"on\")) {\r\n        if (element.attrs && element.attrs[key]) {\r\n          dom.addEventListener(key.substring(2).toLowerCase(), element.attrs[key], { capture: true })\r\n        }\r\n      }\r\n      else {\r\n        this.setDomAttribute(dom, key, element.attrs[key]);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < element.children.length || i < dom.childNodes.length; ++i) {\r\n      // Remove the excess amount of children\r\n      if (element.children[i] === undefined) {\r\n        dom.removeChild(dom.childNodes[i--]);\r\n        continue;\r\n      }\r\n\r\n      if (typeof element.children[i].tag === \"function\") {\r\n        const container = document.createElement(\"div\");\r\n        component.__children.push(this.render(element.children[i], container) as number);\r\n\r\n        if (dom.childNodes[i] === undefined) {\r\n          dom.appendChild(container.firstChild as HTMLElement);\r\n        }\r\n        else {\r\n          dom.insertBefore(container.firstChild as HTMLElement, dom.childNodes[i]);\r\n        }\r\n      }\r\n      else if (Array.isArray(element.children[i])) {\r\n        const oldarr = oldElement.children[i];\r\n        const newarr = element.children[i];\r\n\r\n        let current: any = {};\r\n\r\n        for (let index = 0; index < oldarr.length; ++index)\r\n          current[oldarr[index].attrs.key] = dom.childNodes[index];\r\n\r\n        for (let oldCursor = 0, newCursor = 0; oldCursor < oldarr.length || newCursor < newarr.length;) {\r\n          if (oldarr[oldCursor]?.attrs.key === newarr[newCursor]?.attrs.key) {\r\n            if (typeof newarr[newCursor].tag === \"function\") {\r\n              this.components[component.__children[oldCursor]].attrs = newarr[newCursor].attrs;\r\n              this.components[component.__children[oldCursor]].update();\r\n            }\r\n            else {\r\n              let target: HTMLElement = current[oldarr[oldCursor].attrs.key];\r\n              const container = document.createElement(\"div\");\r\n              this._render(container, newarr[newCursor], component, { svg: false, parent: false });\r\n              dom.replaceChild(container.firstChild as HTMLElement, target);\r\n            }\r\n\r\n            ++oldCursor;\r\n            ++newCursor;\r\n          }\r\n          else if (oldarr[oldCursor] && newarr[newCursor]) {\r\n            let target: HTMLElement = current[oldarr[oldCursor].attrs.key];\r\n            const container = document.createElement(\"div\");\r\n            if (typeof newarr[newCursor].tag === \"function\")\r\n              component.__children.push(this.render(newarr[newCursor], container) as number);\r\n            else\r\n              this._render(container, newarr[newCursor], component, { svg: false, parent: false });\r\n\r\n            dom.insertBefore(container.firstChild as HTMLElement, target);\r\n\r\n            ++newCursor;\r\n          }\r\n          else if (!oldarr[oldCursor] && newarr[newCursor]) {\r\n            const container = document.createElement(\"div\");\r\n            if (typeof newarr[newCursor].tag === \"function\")\r\n              component.__children.push(this.render(newarr[newCursor], container) as number);\r\n            else\r\n              this._render(container, newarr[newCursor], component, { svg: false, parent: false });\r\n            dom.appendChild(container.firstChild as HTMLElement);\r\n\r\n            ++newCursor;\r\n          }\r\n          else if (oldarr[oldCursor] && !newarr[newCursor]) {\r\n            dom.removeChild(current[oldarr[oldCursor].attrs.key]);\r\n\r\n            ++oldCursor;\r\n            ++newCursor;\r\n          }\r\n          else {\r\n            ++oldCursor;\r\n            ++newCursor;\r\n          }\r\n        }\r\n\r\n        break;\r\n      }\r\n      else if (typeof element.children[i] === \"object\") {\r\n        if (dom.childNodes[i] === undefined) {\r\n          dom.appendChild(document.createElement(element.children[i].tag));\r\n        }\r\n        else if (dom.childNodes[i].nodeType !== document.ELEMENT_NODE) {\r\n          dom.insertBefore(document.createElement(element.children[i].tag), dom.childNodes[i]);\r\n        }\r\n\r\n        this._update(dom.childNodes[i] as HTMLElement, element.children[i], oldElement.children[i], component);\r\n      }\r\n      else {\r\n        if (dom.childNodes[i] === undefined) {\r\n          dom.appendChild(document.createTextNode(element.children[i]));\r\n        }\r\n        else if (dom.childNodes[i].nodeType !== document.TEXT_NODE) {\r\n          dom.insertBefore(document.createTextNode(element.children[i]), dom.childNodes[i]);\r\n        }\r\n        else if (dom.childNodes[i].nodeValue !== element.children[i]) {\r\n          dom.childNodes[i].nodeValue = element.children[i];\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < component.__children.length; ++i) {\r\n      // If DOM of the component doesn't have a parent, it's removed\r\n      if (!this.components[component.__children[i]].__dom.parentNode) {\r\n        delete this.components[component.__children[i]];\r\n        component.__children.splice(i--, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  private setDomAttribute(dom: HTMLElement, key: string, value: any) {\r\n    switch (key) {\r\n      case \"key\":\r\n        break;\r\n      case \"ref\":\r\n        value.dom = dom;\r\n        break;\r\n      case \"\":\r\n        break;\r\n      default:\r\n        dom.setAttribute(key, value);\r\n        break;\r\n    }\r\n  }\r\n\r\n  private removeDomAttribute(dom: HTMLElement, key: string) {\r\n    switch (key) {\r\n      case \"key\":\r\n        break;\r\n      case \"ref\":\r\n        break;\r\n      case \"\":\r\n        break;\r\n      default:\r\n        dom.removeAttribute(key);\r\n        break;\r\n    }\r\n  }\r\n\r\n  private processWork() {\r\n    for (let i = 0; i < this.work.length; ++i) {\r\n      this.currentComponent.__hookId = this.work[i].hookId;\r\n      this.work[i].cb();\r\n    }\r\n\r\n    this.work = [];\r\n  }\r\n}\r\n\r\nexport const soda = new Soda();"],"names":[],"mappings":"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"}